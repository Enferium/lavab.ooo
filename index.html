<!doctype html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>hello phaser!</title>
        <script src="//cdn.jsdelivr.net/phaser/2.5.0/phaser.min.js"></script>
    </head>
    <body>

    <script type="text/javascript">
function getRandomInt(max) {
  return Math.floor(Math.random() * Math.floor(max));
}

    window.onload = function() {


var game = new Phaser.Game(800, 600, Phaser.AUTO, 'IL EST BEAU LE LAVABO', { preload: preload, create: create, update: update, render: render });

var game = new Phaser.Game(window.screen.availWidth * window.devicePixelRatio, window.screen.availHeight * window.devicePixelRatio, Phaser.CANVAS, 'game');

function preload() {

    game.load.image('sink', 'sink.png');
    game.load.image('goutte', 'goutte.png');
    game.load.physics("goutte_physics", "goutte.json");


}

var ship;
var starfield;
var cursors;

function create() {

    game.add.sprite(80, 0, 'sink');



    //  Enable P2
    game.physics.startSystem(Phaser.Physics.P2JS);

    //  Turn on impact events for the world, without this we get no collision callbacks
    game.physics.p2.setImpactEvents(true);
    game.physics.p2.gravity.y = 100;

    game.physics.p2.restitution = 0.8;

    //  Create our collision groups. One for the player, one for the pandas
    goutteCollisionGroup = game.physics.p2.createCollisionGroup();

    //  This part is vital if you want the objects with their own collision groups to still collide with the world bounds
    //  (which we do) - what this does is adjust the bounds to use its own collision group.
    game.physics.p2.updateBoundsCollisionGroup();

    gouttes = game.add.group();
    gouttes.enableBody = true;
    gouttes.physicsBodyType = Phaser.Physics.P2JS;

}


function update() {
        if(getRandomInt(10)==1){
        var gouttte = gouttes.create(400, 100, 'goutte');
        gouttte.body.clearShapes();
        gouttte.body.loadPolygon('goutte_physics','goutte');

        //  Tell the panda to use the pandaCollisionGroup 
        gouttte.body.setCollisionGroup(goutteCollisionGroup);

        gouttte.body.collides(goutteCollisionGroup);
    }

        //  Pandas will collide against themselves and the player
        //  If you don't set this they'll not collide with anything.
        //  The first parameter is either an array or a single collision group.
   

}

function render() {


}
};

        //  Note that this html file is set to pull down Phaser 2.5.0 from the JS Delivr CDN.
        //  Although it will work fine with this tutorial, it's almost certainly not the most current version.
        //  Be sure to replace it with an updated version before you start experimenting with adding your own code.
/*
var game = new Phaser.Game(800, 600, Phaser.AUTO, 'phaser-example', { preload: preload, create: create, update: update });


        function preload () {

            game.load.image('sink', 'sink.png');
            game.load.image('goutte', 'goutte.png');


        }

        function create () {
    game.physics.arcade.gravity.y = 100;

            game.add.sprite(80, 0, 'sink');

            gouttes = game.add.physicsGroup(Phaser.Physics.ARCADE);
            gouttes.setAll('body.collideWorldBounds', true);
            gouttes.setAll('body.bounce.x', 1);
            gouttes.setAll('body.bounce.y', 1);


        }

        function update(){
            
            if(getRandomInt(100)==1){
            gout = gouttes.create(400,100,'goutte').scale.setTo(0.3,0.3);
            gouttes.setAll('body.collideWorldBounds', true);
        }
    game.physics.arcade.collide(gouttes);


        }

    };*/

    </script>

    </body>
</html>